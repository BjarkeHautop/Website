<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Cox model case study</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Cox model case study</li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../projects/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Projects</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">About me</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data" id="toc-data" class="nav-link active" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data">Loading data</a></li>
  <li><a href="#imputing-missing-values" id="toc-imputing-missing-values" class="nav-link" data-scroll-target="#imputing-missing-values">Imputing missing values</a></li>
  </ul></li>
  <li><a href="#specifying-the-model" id="toc-specifying-the-model" class="nav-link" data-scroll-target="#specifying-the-model">Specifying the model</a>
  <ul class="collapse">
  <li><a href="#data-reduction-using-domain-knowledge" id="toc-data-reduction-using-domain-knowledge" class="nav-link" data-scroll-target="#data-reduction-using-domain-knowledge">Data reduction using domain knowledge</a></li>
  <li><a href="#checking-proportional-hazards" id="toc-checking-proportional-hazards" class="nav-link" data-scroll-target="#checking-proportional-hazards">Checking Proportional Hazards</a></li>
  <li><a href="#describing-effects" id="toc-describing-effects" class="nav-link" data-scroll-target="#describing-effects">Describing Effects</a></li>
  </ul></li>
  <li><a href="#presenting-the-final-model-for-inference" id="toc-presenting-the-final-model-for-inference" class="nav-link" data-scroll-target="#presenting-the-final-model-for-inference">Presenting the final model for inference</a></li>
  <li><a href="#model-for-prediction" id="toc-model-for-prediction" class="nav-link" data-scroll-target="#model-for-prediction">Model for prediction</a>
  <ul class="collapse">
  <li><a href="#validating-the-model" id="toc-validating-the-model" class="nav-link" data-scroll-target="#validating-the-model">Validating the model</a>
  <ul class="collapse">
  <li><a href="#validate-the-model-for-predicting-the-probability-of-surviving-five-years" id="toc-validate-the-model-for-predicting-the-probability-of-surviving-five-years" class="nav-link" data-scroll-target="#validate-the-model-for-predicting-the-probability-of-surviving-five-years">Validate the model for predicting the probability of surviving five years</a></li>
  </ul></li>
  <li><a href="#final-model-for-prediction" id="toc-final-model-for-prediction" class="nav-link" data-scroll-target="#final-model-for-prediction">Final model for prediction</a>
  <ul class="collapse">
  <li><a href="#approximating-the-full-model" id="toc-approximating-the-full-model" class="nav-link" data-scroll-target="#approximating-the-full-model">Approximating the full model</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Cox model case study</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Survival analysis</div>
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">July, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Analyzing prostate cancer dataset using a Cox model. The primary goal is to discover patterns in survival, and to do an analysis of covariance to assess the effect of treatment while adjusting for patient heterogeneity. Prediction is a secondary goal.</p>
<!--more-->
<section id="data" class="level1">
<h1>Data</h1>
<p>We consider the 506-patient prostate cancer dataset from Byar and Green. These data were from a randomized trial comparing four treatments for stage 3 and 4 prostate cancer, with almost equal numbers of patients on placebo and each of three doses of estrogen. Four patients had missing values on all of the following variables: wt, pf, hx, sbp, dbp, ekg, hg, bm; two of these patients were also missing sz. These patients are excluded from consideration.</p>
<p>We will follow guidelines given in the book Regression Modeling Strategies by Frank Harrell and his general approach to this dataset in Chapter 21. The analysis is expanded compared to what was done in the book.</p>
<p>There are 354 deaths among the 502 patients and we will use a multivariate survival model to explain the time until death (of any cause).</p>
<section id="loading-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-data">Loading data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">getHdata</span>(prostate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We start by showing summary of all the variables in the dataset</p>
<details>
<summary>
Click here to see output
</summary>
<p>Preprocess data for function <code>datasummary_skim</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>prostate_summary <span class="ot">&lt;-</span> prostate</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert 'labelled' columns to numeric</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>prostate_summary[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(prostate_summary, <span class="cf">function</span>(x) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(x, <span class="st">"labelled"</span>)) {</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>prostate_summary<span class="sc">$</span>bm <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(prostate<span class="sc">$</span>bm)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>prostate_summary<span class="sc">$</span>stage <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(prostate<span class="sc">$</span>stage)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>prostate_summary<span class="sc">$</span>hx <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(prostate<span class="sc">$</span>hx)</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>prostate_summary <span class="ot">&lt;-</span> prostate_summary[</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  ,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">names</span>(prostate) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"patno"</span>, <span class="st">"sdate"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>factors <span class="ot">&lt;-</span> <span class="fu">sapply</span>(prostate_summary, is.factor)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Summary of factor variables in data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary_skim</span>(prostate_summary[factors])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_6865g9yaecckioxnm5zc(i, j, css_id) {
        var table = document.getElementById("tinytable_6865g9yaecckioxnm5zc");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_6865g9yaecckioxnm5zc');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_6865g9yaecckioxnm5zc(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_6865g9yaecckioxnm5zc");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(0, 0, 'tinytable_css_idguuyc90fzn5vzuvfd2fo') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(0, 1, 'tinytable_css_idguuyc90fzn5vzuvfd2fo') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(0, 2, 'tinytable_css_idyhhih3ipt9a3xxy6zfps') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(0, 3, 'tinytable_css_idyhhih3ipt9a3xxy6zfps') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(1, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(1, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(1, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(1, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(2, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(2, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(2, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(2, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(3, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(3, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(3, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(3, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(4, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(4, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(4, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(4, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(5, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(5, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(5, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(5, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(6, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(6, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(6, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(6, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(7, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(7, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(7, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(7, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(8, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(8, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(8, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(8, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(9, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(9, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(9, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(9, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(10, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(10, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(10, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(10, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(11, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(11, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(11, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(11, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(12, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(12, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(12, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(12, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(13, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(13, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(13, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(13, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(14, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(14, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(14, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(14, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(15, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(15, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(15, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(15, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(16, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(16, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(16, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(16, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(17, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(17, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(17, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(17, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(18, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(18, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(18, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(18, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(19, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(19, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(19, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(19, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(20, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(20, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(20, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(20, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(21, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(21, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(21, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(21, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(22, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(22, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(22, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(22, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(23, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(23, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(23, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(23, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(24, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(24, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(24, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(24, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(25, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(25, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(25, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(25, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(26, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(26, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(26, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(26, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(27, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(27, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(27, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(27, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(28, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(28, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(28, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(28, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(29, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(29, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(29, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(29, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(30, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(30, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(30, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(30, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(31, 0, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(31, 1, 'tinytable_css_idry50udwytb1zr0af3r6j') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(31, 2, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
window.addEventListener('load', function () { styleCell_6865g9yaecckioxnm5zc(31, 3, 'tinytable_css_idujrzjz1fyydbp4tpcb7f') })
    </script>

    <style>
    .table td.tinytable_css_idguuyc90fzn5vzuvfd2fo, .table th.tinytable_css_idguuyc90fzn5vzuvfd2fo {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idyhhih3ipt9a3xxy6zfps, .table th.tinytable_css_idyhhih3ipt9a3xxy6zfps {  text-align: right;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idry50udwytb1zr0af3r6j, .table th.tinytable_css_idry50udwytb1zr0af3r6j {  text-align: left; }
    .table td.tinytable_css_idujrzjz1fyydbp4tpcb7f, .table th.tinytable_css_idujrzjz1fyydbp4tpcb7f {  text-align: right; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_6865g9yaecckioxnm5zc" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"></th>
                <th scope="col"></th>
                <th scope="col">N</th>
                <th scope="col">%</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>stage</td>
                  <td>3</td>
                  <td>289</td>
                  <td>57.6</td>
                </tr>
                <tr>
                  <td></td>
                  <td>4</td>
                  <td>213</td>
                  <td>42.4</td>
                </tr>
                <tr>
                  <td>rx</td>
                  <td>placebo</td>
                  <td>127</td>
                  <td>25.3</td>
                </tr>
                <tr>
                  <td></td>
                  <td>0.2 mg estrogen</td>
                  <td>124</td>
                  <td>24.7</td>
                </tr>
                <tr>
                  <td></td>
                  <td>1.0 mg estrogen</td>
                  <td>126</td>
                  <td>25.1</td>
                </tr>
                <tr>
                  <td></td>
                  <td>5.0 mg estrogen</td>
                  <td>125</td>
                  <td>24.9</td>
                </tr>
                <tr>
                  <td>status</td>
                  <td>alive</td>
                  <td>148</td>
                  <td>29.5</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - prostatic ca</td>
                  <td>130</td>
                  <td>25.9</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - heart or vascular</td>
                  <td>96</td>
                  <td>19.1</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - cerebrovascular</td>
                  <td>31</td>
                  <td>6.2</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - pulmonary embolus</td>
                  <td>14</td>
                  <td>2.8</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - other ca</td>
                  <td>25</td>
                  <td>5.0</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - respiratory disease</td>
                  <td>16</td>
                  <td>3.2</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - other specific non-ca</td>
                  <td>28</td>
                  <td>5.6</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - unspecified non-ca</td>
                  <td>7</td>
                  <td>1.4</td>
                </tr>
                <tr>
                  <td></td>
                  <td>dead - unknown cause</td>
                  <td>7</td>
                  <td>1.4</td>
                </tr>
                <tr>
                  <td>pf</td>
                  <td>normal activity</td>
                  <td>450</td>
                  <td>89.6</td>
                </tr>
                <tr>
                  <td></td>
                  <td>in bed &lt; 50% daytime</td>
                  <td>37</td>
                  <td>7.4</td>
                </tr>
                <tr>
                  <td></td>
                  <td>in bed &gt; 50% daytime</td>
                  <td>13</td>
                  <td>2.6</td>
                </tr>
                <tr>
                  <td></td>
                  <td>confined to bed</td>
                  <td>2</td>
                  <td>0.4</td>
                </tr>
                <tr>
                  <td>hx</td>
                  <td>0</td>
                  <td>289</td>
                  <td>57.6</td>
                </tr>
                <tr>
                  <td></td>
                  <td>1</td>
                  <td>213</td>
                  <td>42.4</td>
                </tr>
                <tr>
                  <td>ekg</td>
                  <td>normal</td>
                  <td>168</td>
                  <td>33.5</td>
                </tr>
                <tr>
                  <td></td>
                  <td>benign</td>
                  <td>23</td>
                  <td>4.6</td>
                </tr>
                <tr>
                  <td></td>
                  <td>rhythmic disturb &amp; electrolyte ch</td>
                  <td>51</td>
                  <td>10.2</td>
                </tr>
                <tr>
                  <td></td>
                  <td>heart block or conduction def</td>
                  <td>26</td>
                  <td>5.2</td>
                </tr>
                <tr>
                  <td></td>
                  <td>heart strain</td>
                  <td>150</td>
                  <td>29.9</td>
                </tr>
                <tr>
                  <td></td>
                  <td>old MI</td>
                  <td>75</td>
                  <td>14.9</td>
                </tr>
                <tr>
                  <td></td>
                  <td>recent MI</td>
                  <td>1</td>
                  <td>0.2</td>
                </tr>
                <tr>
                  <td>bm</td>
                  <td>0</td>
                  <td>420</td>
                  <td>83.7</td>
                </tr>
                <tr>
                  <td></td>
                  <td>1</td>
                  <td>82</td>
                  <td>16.3</td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
<p>Summary of continuous variables in data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary_skim</span>(prostate_summary[<span class="sc">!</span>factors])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>
      function styleCell_hc2lxz1unuq8toqoez74(i, j, css_id) {
        var table = document.getElementById("tinytable_hc2lxz1unuq8toqoez74");
        table.rows[i].cells[j].classList.add(css_id);
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_hc2lxz1unuq8toqoez74');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_hc2lxz1unuq8toqoez74(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_hc2lxz1unuq8toqoez74");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 0, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 1, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 2, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 3, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 4, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 5, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 6, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 7, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(0, 8, 'tinytable_css_idzysuvbqenl5g0dib2y6j') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(1, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(2, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(3, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(4, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(5, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(6, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(7, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(8, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 0, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 1, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 2, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 3, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 4, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 5, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 6, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 7, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
window.addEventListener('load', function () { styleCell_hc2lxz1unuq8toqoez74(9, 8, 'tinytable_css_idocwt8g614a0ykk8vnnt5') })
    </script>

    <style>
    .table td.tinytable_css_idzysuvbqenl5g0dib2y6j, .table th.tinytable_css_idzysuvbqenl5g0dib2y6j {  text-align: left;  border-bottom: solid 0.1em #d3d8dc; }
    .table td.tinytable_css_idocwt8g614a0ykk8vnnt5, .table th.tinytable_css_idocwt8g614a0ykk8vnnt5 {  text-align: left; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_hc2lxz1unuq8toqoez74" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"></th>
                <th scope="col">Unique</th>
                <th scope="col">Missing Pct.</th>
                <th scope="col">Mean</th>
                <th scope="col">SD</th>
                <th scope="col">Min</th>
                <th scope="col">Median</th>
                <th scope="col">Max</th>
                <th scope="col">Histogram</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>dtime</td>
                  <td>76</td>
                  <td>0</td>
                  <td>36.1</td>
                  <td>23.3</td>
                  <td>0.0</td>
                  <td>34.0</td>
                  <td>76.0</td>
                  <td><img src="./tinytable_assets/idbjg42buh20wef87x7jqp.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>age</td>
                  <td>42</td>
                  <td>0</td>
                  <td>71.5</td>
                  <td>7.1</td>
                  <td>48.0</td>
                  <td>73.0</td>
                  <td>89.0</td>
                  <td><img src="./tinytable_assets/idsy90icn51l98asanna9o.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>wt</td>
                  <td>68</td>
                  <td>0</td>
                  <td>99.0</td>
                  <td>13.4</td>
                  <td>69.0</td>
                  <td>98.0</td>
                  <td>152.0</td>
                  <td><img src="./tinytable_assets/ida5a6md9hfew9dmrvsgwv.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>sbp</td>
                  <td>18</td>
                  <td>0</td>
                  <td>14.4</td>
                  <td>2.4</td>
                  <td>8.0</td>
                  <td>14.0</td>
                  <td>30.0</td>
                  <td><img src="./tinytable_assets/idc48z5z9qgn0612nm0ax1.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>dbp</td>
                  <td>12</td>
                  <td>0</td>
                  <td>8.1</td>
                  <td>1.5</td>
                  <td>4.0</td>
                  <td>8.0</td>
                  <td>18.0</td>
                  <td><img src="./tinytable_assets/idnwsq6xd9hd8ixahrro7o.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>hg</td>
                  <td>91</td>
                  <td>0</td>
                  <td>13.4</td>
                  <td>2.0</td>
                  <td>5.9</td>
                  <td>13.7</td>
                  <td>21.2</td>
                  <td><img src="./tinytable_assets/id5ve4bu60u0y2ujg2fgcp.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>sz</td>
                  <td>56</td>
                  <td>1</td>
                  <td>14.6</td>
                  <td>12.3</td>
                  <td>0.0</td>
                  <td>11.0</td>
                  <td>69.0</td>
                  <td><img src="./tinytable_assets/idz01zc4o456s78dr3o4qd.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>sg</td>
                  <td>12</td>
                  <td>2</td>
                  <td>10.3</td>
                  <td>2.0</td>
                  <td>5.0</td>
                  <td>10.0</td>
                  <td>15.0</td>
                  <td><img src="./tinytable_assets/idf5sqvxld98fov8kg5qed.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>ap</td>
                  <td>128</td>
                  <td>0</td>
                  <td>12.2</td>
                  <td>62.2</td>
                  <td>0.1</td>
                  <td>0.7</td>
                  <td>999.9</td>
                  <td><img src="./tinytable_assets/idmd5luljjd5emtiu6gpzp.png" style="height: 1em;"></td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
</div>
</details>
<p>We see that the variable ekg only has one observation in the last category and pf has two. So, we combine recent MI with old MI and call it MI, and we combine confined to bed with <span class="math inline">\(&gt;50\%\)</span> daytime.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(prostate<span class="sc">$</span>ekg)[<span class="fu">levels</span>(prostate<span class="sc">$</span>ekg) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"old MI"</span>, <span class="st">"recent MI"</span>)] <span class="ot">&lt;-</span> <span class="st">"MI"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(prostate<span class="sc">$</span>pf) <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>(prostate<span class="sc">$</span>pf)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">levels</span>(prostate<span class="sc">$</span>pf)[<span class="dv">3</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="imputing-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="imputing-missing-values">Imputing missing values</h2>
<p>We have 27 patients with missing values as seen below, so we do imputation on these.</p>
<p>The proportion of missing values is <span class="math inline">\(0.05\)</span>, so we just do single imputation, since simpler to make plots and validation. However if the proportion were higher one should do multiple imputation.</p>
<div class="cell" data-warn.conflicts="false">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(prostate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 27</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(prostate))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> patno  stage     rx  dtime status    age     wt     pf     hx    sbp    dbp 
     0      0      0      0      0      1      2      0      0      0      0 
   ekg     hg     sz     sg     ap     bm  sdate 
     8      0      5     11      0      0      0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">transcan</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span> sz <span class="sc">+</span> sg <span class="sc">+</span> ap <span class="sc">+</span> sbp <span class="sc">+</span> dbp <span class="sc">+</span> age <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    wt <span class="sc">+</span> hg <span class="sc">+</span> ekg <span class="sc">+</span> pf <span class="sc">+</span> bm <span class="sc">+</span> hx,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">imputed =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> prostate, <span class="at">pl =</span> <span class="cn">FALSE</span>, <span class="at">pr =</span> <span class="cn">FALSE</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">attach</span>(prostate)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>sz <span class="ot">&lt;-</span> <span class="fu">impute</span>(w, sz, <span class="at">data =</span> prostate)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>sg <span class="ot">&lt;-</span> <span class="fu">impute</span>(w, sg, <span class="at">data =</span> prostate)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">impute</span>(w, age, <span class="at">data =</span> prostate)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">impute</span>(w, wt, <span class="at">data =</span> prostate)</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>kg <span class="ot">&lt;-</span> <span class="fu">impute</span>(w, ekg, <span class="at">data =</span> prostate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="specifying-the-model" class="level1">
<h1>Specifying the model</h1>
<p>A Cox proportional hazards model is in terms of the hazard function given by: <span class="math display">\[\lambda(t\vert X)=\lambda(t)\exp(X\beta).\]</span> We fit a Cox proportional hazards model with the predictors and their degrees of freedom specified in the table below. All continuous predictors will be modeled with a restricted cubic spline with 4 knots.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Predictor</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Name</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">d.f.</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Levels</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Dose of estrogen</td>
<td style="text-align: left;">rx</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;">placebo, 0.2, 1.0, 5.0 mg estrogen</td>
</tr>
<tr class="even">
<td style="text-align: left;">Age in years</td>
<td style="text-align: left;">age</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Weight index</td>
<td style="text-align: left;">wt</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Performance rating</td>
<td style="text-align: left;">pf</td>
<td style="text-align: right;">2</td>
<td style="text-align: left;">normal, in bed &lt; 50% of time, in bed &gt; 50%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">History of cardiovascular disease</td>
<td style="text-align: left;">hx</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">present/absent</td>
</tr>
<tr class="even">
<td style="text-align: left;">Systolic blood pressure/10</td>
<td style="text-align: left;">sbp</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Diastolic blood pressure/10</td>
<td style="text-align: left;">dbp</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Electrocardiogram code</td>
<td style="text-align: left;">ekg</td>
<td style="text-align: right;">5</td>
<td style="text-align: left;">normal, benign, rhythm disturb., block, strain, myocardial infarction</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Serum hemoglobin (g/100ml)</td>
<td style="text-align: left;">hg</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Tumor size (cm^2)</td>
<td style="text-align: left;">sz</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Stage/histologic grade combination</td>
<td style="text-align: left;">sg</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Serum prostatic acid phosphatase</td>
<td style="text-align: left;">ap</td>
<td style="text-align: right;">3</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bone metastasis</td>
<td style="text-align: left;">bm</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">present/absent</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>We see that we have 36 degrees of freedom in our model, so about 1/10 of the amount of deaths there are. So there is some hope our model will validate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(prostate)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">datadist =</span> <span class="st">"dd"</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">units</span>(dtime) <span class="ot">&lt;-</span> <span class="st">"Month"</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">Surv</span>(dtime, status <span class="sc">!=</span> <span class="st">"alive"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">cph</span>(s <span class="sc">~</span> rx <span class="sc">+</span> <span class="fu">rcs</span>(age, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(wt, <span class="dv">4</span>) <span class="sc">+</span> pf <span class="sc">+</span> hx <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rcs</span>(sbp, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(dbp, <span class="dv">4</span>) <span class="sc">+</span> ekg <span class="sc">+</span> <span class="fu">rcs</span>(hg, <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>           <span class="fu">rcs</span>(sg, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(sz, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(<span class="fu">log</span>(ap), <span class="dv">4</span>) <span class="sc">+</span> bm)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(f, <span class="at">html =</span> <span class="cn">TRUE</span>, <span class="at">coefs =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Frequencies of Missing Values Due to Each Variable
  s  rx age  wt  pf  hx sbp dbp ekg  hg  sg  sz  ap  bm 
  0   0   0   0   0   0   0   0   8   0   0   0   0   0 

Cox Proportional Hazards Model

cph(formula = s ~ rx + rcs(age, 4) + rcs(wt, 4) + pf + hx + rcs(sbp, 
    4) + rcs(dbp, 4) + ekg + rcs(hg, 4) + rcs(sg, 4) + rcs(sz, 
    4) + rcs(log(ap), 4) + bm)

                        Model Tests     Discrimination    
                                               Indexes    
Obs        494    LR chi2    136.04     R2       0.241    
Events     348    d.f.           36    R2(36,494)0.183    
Center -2.0435    Pr(&gt; chi2) 0.0000    R2(36,348)0.250    
                  Score chi2 144.95     Dxy      0.338    
                  Pr(&gt; chi2) 0.0000                       </code></pre>
</div>
</div>
<p>Test for removing all predictors is highly significant, so modelling is warranted. AIC on the <span class="math inline">\(\chi^2\)</span>-scale is given by <span class="math inline">\(136.04-2\cdot 36=64.04\)</span>. A rough shrinkage estimate is thus given by <span class="math inline">\((136.04-36)/136.04=0.74\)</span>. So we estimate that 0.26 of the model fitting will be noise, especially with regard to calibration accuracy. One approach would just be to multiply coefficients of final model if used for prediction by the shrinkage estimate. Instead we try to do some data reduction using domain knowledge.</p>
<section id="data-reduction-using-domain-knowledge" class="level2">
<h2 class="anchored" data-anchor-id="data-reduction-using-domain-knowledge">Data reduction using domain knowledge</h2>
<p>We do the following changes</p>
<ul>
<li><p>Combine systolic blood pressure (sbp) and diastolic blood pressure (dbp) into Mean Arterial Pressure.</p></li>
<li><p>Combine history of cardiovascular disease (hx) and electrocardiogram code ekg and assume linear. We code it as 2 if ekg are not normal or benign and hx, 1 if either, and 0 if none.</p></li>
<li><p>Weight index not that important, so only use 3 knots.</p></li>
<li><p>Take log of Serum prostatic acid phosphatase (ap) for numeric stability (heavy right-tail) and allow 1 more knot for compensation</p></li>
<li><p>The tumor variables tumor size (sz) and stage/histologic grade combination (sg) should be important variables, but since we have both we keep them but give them only 3 knots each.</p></li>
<li><p>Assume performance rating (pf) is linear.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>map <span class="ot">&lt;-</span> (<span class="dv">2</span> <span class="sc">*</span> dbp <span class="sc">+</span> sbp) <span class="sc">/</span> <span class="dv">3</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(map) <span class="ot">&lt;-</span> <span class="st">"Mean Arterial Pressure/10"</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>heart_d <span class="ot">&lt;-</span> hx <span class="sc">+</span> ekg <span class="sc">%nin%</span> <span class="fu">c</span>(<span class="st">"normal"</span>, <span class="st">"benign"</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(heart_d) <span class="ot">&lt;-</span> <span class="st">"Heart Disease Code"</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>pf_linear <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(pf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>So all in all we save 3 degrees of freedom from defining map, 5 for defining Heart Disease Code, and 3 for dropping knots, 1 for assuming performance rating is linear and gain 1 from ap. For a total reduction of 11 degrees of freedom.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dd <span class="ot">&lt;-</span> <span class="fu">datadist</span>(dd, heart_d, map, pf_linear)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">cph</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  s <span class="sc">~</span> rx <span class="sc">+</span> <span class="fu">rcs</span>(age, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(wt, <span class="dv">3</span>) <span class="sc">+</span> pf_linear <span class="sc">+</span> heart_d <span class="sc">+</span> <span class="fu">rcs</span>(map, <span class="dv">3</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="sc">+</span> <span class="fu">rcs</span>(hg, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(sg, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">rcs</span>(sz, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">rcs</span>(<span class="fu">log</span>(ap), <span class="dv">5</span>) <span class="sc">+</span> bm,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="cn">TRUE</span>, <span class="at">y =</span> <span class="cn">TRUE</span>, <span class="at">surv =</span> <span class="cn">TRUE</span>, <span class="at">time.inc =</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(f, <span class="at">html =</span> <span class="cn">TRUE</span>, <span class="at">coefs =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cox Proportional Hazards Model

cph(formula = s ~ rx + rcs(age, 4) + rcs(wt, 3) + pf_linear + 
    heart_d + rcs(map, 3) + rcs(hg, 4) + rcs(sg, 3) + rcs(sz, 
    3) + rcs(log(ap), 5) + bm, x = TRUE, y = TRUE, surv = TRUE, 
    time.inc = 5 * 12)

                        Model Tests     Discrimination    
                                               Indexes    
Obs        502    LR chi2    119.86     R2       0.212    
Events     354    d.f.           24    R2(24,502)0.174    
Center -2.3792    Pr(&gt; chi2) 0.0000    R2(24,354)0.237    
                  Score chi2 126.89     Dxy      0.323    
                  Pr(&gt; chi2) 0.0000                       

                   Coef     S.E.    Wald Z Pr(&gt;|Z|)
rx=0.2 mg estrogen   0.0005  0.1492  0.00  0.9975  
rx=1.0 mg estrogen  -0.4136  0.1659 -2.49  0.0127  
rx=5.0 mg estrogen  -0.1044  0.1572 -0.66  0.5066  
. . .                                              </code></pre>
</div>
</div>
<p>LR 119.86 with 24 degrees of freedom. AIC is <span class="math inline">\(119.86-2 \cdot 24=71.86\)</span>. Rough shrinkage estimate of this is now better at <span class="math inline">\((119.86-24)/119.86=0.80\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(f, <span class="at">html =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Wald Statistics          Response: s 

 Factor          Chi-Square d.f. P     
 rx                7.92      3   0.0476
 age              13.65      3   0.0034
  Nonlinear        8.94      2   0.0115
 wt                8.23      2   0.0163
  Nonlinear        2.57      1   0.1092
 pf_linear         3.50      1   0.0615
 heart_d          24.91      1   &lt;.0001
 map               0.05      2   0.9753
  Nonlinear        0.05      1   0.8232
 hg               12.49      3   0.0059
  Nonlinear        8.10      2   0.0174
 sg                1.70      2   0.4269
  Nonlinear        0.05      1   0.8318
 sz               12.43      2   0.0020
  Nonlinear        0.07      1   0.7888
 ap                6.46      4   0.1672
  Nonlinear        6.16      3   0.1042
 bm                0.03      1   0.8523
 TOTAL NONLINEAR  23.58     11   0.0146
 TOTAL           120.27     24   &lt;.0001</code></pre>
</div>
</div>
<p>We see that the p-value for the treatment, doses of estrogen (rx), is below <span class="math inline">\(0.05\)</span>, so it seems like it has some effect.</p>
</section>
<section id="checking-proportional-hazards" class="level2">
<h2 class="anchored" data-anchor-id="checking-proportional-hazards">Checking Proportional Hazards</h2>
<p>A Cox model should have proportional hazards, since if we look at two individuals with covariate values <span class="math inline">\(\boldsymbol{X}\)</span> and <span class="math inline">\(\boldsymbol{X}^*\)</span> then the ratio of their hazard rates is <span class="math display">\[\frac{h(t \vert \boldsymbol{X})}{h(t \vert \boldsymbol{X}^*)}=\exp\Big[\sum_{k=1}^p \beta_k(X_k-X_{k^*})\Big],\]</span> which is a constant. We can test this assumption using scaled Schoenfeld residuals separately for each predictor and test the PH assumption using the “correlation with time” test. Smoothed trends in the residuals are also plotted.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">predict</span>(f, <span class="at">type =</span> <span class="st">"terms"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>f_short <span class="ot">&lt;-</span> <span class="fu">cph</span>(s <span class="sc">~</span> z, <span class="at">x =</span> <span class="cn">TRUE</span>, <span class="at">y =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>phtest <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(f_short, <span class="at">transform =</span> <span class="st">"identity"</span>, <span class="at">terms =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>phtest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             chisq df     p
rx        3.906254  1 0.048
age       1.218347  1 0.270
wt        0.016868  1 0.897
pf_linear 0.190007  1 0.663
heart_d   0.360714  1 0.548
map       0.046079  1 0.830
hg        0.018155  1 0.893
sg        0.904761  1 0.342
sz        0.218858  1 0.640
ap        0.009228  1 0.923
bm        0.000329  1 0.986
GLOBAL    7.813453 11 0.730</code></pre>
</div>
</div>
<p>We see that the p-value of the test for proportional hazards is below <span class="math inline">\(0.05\)</span> for dose of estrogen, indicating that it may not have constant relative hazard. We plot it and don’t find anything too worry-some, and the global test of proportional hazard by adjusting for the 11 tests gives a p-value of <span class="math inline">\(0.78\)</span>. So we accept our model and continue.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(phtest, <span class="at">var =</span> <span class="st">"rx"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cox_files/figure-html/plot proportional hazards-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="describing-effects" class="level2">
<h2 class="anchored" data-anchor-id="describing-effects">Describing Effects</h2>
<p>We plot how each predictor is related to the log hazard of death with <span class="math inline">\(95\%\)</span>-confidence bands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">Predict</span>(f),</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">sepdiscrete =</span> <span class="st">"vertical"</span>, <span class="at">nlevels =</span> <span class="dv">4</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">vnames =</span> <span class="st">"names"</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cox_files/figure-html/plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="presenting-the-final-model-for-inference" class="level1">
<h1>Presenting the final model for inference</h1>
<p>To present point and interval estimates of predictor effects we draw a hazard ratio chart. Since the ap relationship is so non-monotonic we use a 20:1 hazard ratio for this variable. The others use the default.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">summary</span>(f, <span class="at">ap =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">20</span>)), <span class="at">log =</span> <span class="cn">TRUE</span>, <span class="at">main =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in formula.character(object, env = baseenv()): Using formula(x) is deprecated when x is a character vector of length &gt; 1.
  Consider formula(paste(x, collapse = " ")) instead.
Warning in formula.character(object, env = baseenv()): Using formula(x) is deprecated when x is a character vector of length &gt; 1.
  Consider formula(paste(x, collapse = " ")) instead.
Warning in formula.character(object, env = baseenv()): Using formula(x) is deprecated when x is a character vector of length &gt; 1.
  Consider formula(paste(x, collapse = " ")) instead.
Warning in formula.character(object, env = baseenv()): Using formula(x) is deprecated when x is a character vector of length &gt; 1.
  Consider formula(paste(x, collapse = " ")) instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cox_files/figure-html/plot hazard ratio-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot is interpreted as the hazard ratio for each variable if we went from for example age 70 to age 76. <span class="math inline">\(95\%, 97.5\%\)</span> and <span class="math inline">\(99\%\)</span> confidence bands are added.</p>
<p>Finally we will also show a nomogram.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>surv <span class="ot">&lt;-</span> <span class="fu">Survival</span>(f)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>surv3 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">surv</span>(<span class="dv">3</span> <span class="sc">*</span> <span class="dv">12</span>, <span class="at">lp =</span> x)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>surv5 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">surv</span>(<span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span>, <span class="at">lp =</span> x)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>quan <span class="ot">&lt;-</span> <span class="fu">Quantile</span>(f)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>med <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">quan</span>(<span class="at">lp =</span> x) <span class="sc">/</span> <span class="dv">12</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ss <span class="ot">&lt;-</span> <span class="fu">c</span>(.<span class="dv">05</span>, .<span class="dv">1</span>, .<span class="dv">2</span>, .<span class="dv">3</span>, .<span class="dv">4</span>, .<span class="dv">5</span>, .<span class="dv">6</span>, .<span class="dv">7</span>, .<span class="dv">8</span>, .<span class="dv">9</span>, .<span class="dv">95</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>nom <span class="ot">&lt;-</span> <span class="fu">nomogram</span>(f,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ap =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> <span class="fu">list</span>(surv3, surv5, med),</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">funlabel =</span> <span class="fu">c</span>(</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"3-year Survival"</span>, <span class="st">"5-year Survival"</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Median Survival Time (years)"</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun.at =</span> <span class="fu">list</span>(ss, ss, <span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>))</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in formula.character(object, env = baseenv()): Using formula(x) is deprecated when x is a character vector of length &gt; 1.
  Consider formula(paste(x, collapse = " ")) instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(nom, <span class="at">cex.axis =</span> <span class="fl">0.8</span>, <span class="at">cex.var =</span> <span class="fl">0.7</span>, <span class="at">xfrac =</span> .<span class="dv">65</span>, <span class="at">lmgp =</span> .<span class="dv">35</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="Nomogram1.png" class="img-fluid"></p>
<p>This is interpreted by taking a value for each predictor and seeing how many points each value correspond to. Then the total amount of points can be used to find the probability of for example 5-year survival.</p>
</section>
<section id="model-for-prediction" class="level1">
<h1>Model for prediction</h1>
<p>For a prediction model one should validate the model. We start by doing that</p>
<section id="validating-the-model" class="level2">
<h2 class="anchored" data-anchor-id="validating-the-model">Validating the model</h2>
<p>We will use bootstrapping for validation. We first validate this model for Somers’ <span class="math inline">\(D_{xy}\)</span> rank correlation between predicted log hazard and observed survival time, and for slope shrinkage. The bootstrap is used (with 1000 resamples) to penalize for possible overfitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>v <span class="ot">&lt;-</span> <span class="fu">validate</span>(f, <span class="at">B =</span> <span class="dv">1000</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">prType =</span> <span class="st">"html"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey;">Index</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Original<br>
Sample</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Training<br>
Sample</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Test<br>
Sample</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Optimism</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Corrected<br>
Index</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Successful<br>
Resamples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><em>D<sub>xy</sub></em></td>
<td style="text-align: center;">0.3228</td>
<td style="text-align: center;">0.3514</td>
<td style="text-align: center;">0.298</td>
<td style="text-align: center;">0.0533</td>
<td style="text-align: center;">0.2695</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>R<sup>2</sup></em></td>
<td style="text-align: center;">0.2125</td>
<td style="text-align: center;">0.2513</td>
<td style="text-align: center;">0.1779</td>
<td style="text-align: center;">0.0735</td>
<td style="text-align: center;">0.139</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Slope</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.7844</td>
<td style="text-align: center;">0.2156</td>
<td style="text-align: center;">0.7844</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>D</em></td>
<td style="text-align: center;">0.0296</td>
<td style="text-align: center;">0.036</td>
<td style="text-align: center;">0.0242</td>
<td style="text-align: center;">0.0118</td>
<td style="text-align: center;">0.0178</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>U</em></td>
<td style="text-align: center;">-5e-04</td>
<td style="text-align: center;">-5e-04</td>
<td style="text-align: center;">0.0025</td>
<td style="text-align: center;">-0.003</td>
<td style="text-align: center;">0.0025</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Q</em></td>
<td style="text-align: center;">0.0301</td>
<td style="text-align: center;">0.0365</td>
<td style="text-align: center;">0.0217</td>
<td style="text-align: center;">0.0148</td>
<td style="text-align: center;">0.0152</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 2px solid grey;"><em>g</em></td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.7245</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.8108</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.6345</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.1763</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.5482</td>
<td style="text-align: center; border-bottom: 2px solid grey;">1000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Here “training” refers to accuracy when evaluated on the bootstrap sample used to fit the model, and “test” refers to the accuracy when this model is applied without modification to the original sample. The apparent <span class="math inline">\(D_{xy}\)</span> is 0.32, but a better estimate of how well the model will discriminate prognoses in the future is <span class="math inline">\(D_{xy} = 0.27\)</span>. The bootstrap estimate of slope shrinkage is <span class="math inline">\(0.79\)</span>, close to the simple heuristic estimate.</p>
<section id="validate-the-model-for-predicting-the-probability-of-surviving-five-years" class="level3">
<h3 class="anchored" data-anchor-id="validate-the-model-for-predicting-the-probability-of-surviving-five-years">Validate the model for predicting the probability of surviving five years</h3>
<p>We will use the non-shrinked estimates to show that this model will have some overfitting consistent with <em>regression to the mean</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>cal <span class="ot">&lt;-</span> <span class="fu">calibrate</span>(f, <span class="at">B =</span> <span class="dv">1000</span>, <span class="at">u =</span> <span class="dv">5</span> <span class="sc">*</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Using Cox survival estimates at 60 Months
Convergence problems.... stopping addition
Convergence problems.... stopping addition
Convergence problems.... stopping addition
Convergence problems.... stopping addition</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cal, <span class="at">subtitles =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cox_files/figure-html/calibrate-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The line nearer the ideal line corresponds to apparent predictive accuracy. The blue curve corresponds to bootstrap-corrected estimates. We clearly see some regression to the mean.</p>
</section>
</section>
<section id="final-model-for-prediction" class="level2">
<h2 class="anchored" data-anchor-id="final-model-for-prediction">Final model for prediction</h2>
<p>For a better model for prediction one should multiply the coefficients in the model by the shrinkage estimate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>v</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; border-bottom: 1px solid grey; font-weight: 900; border-top: 2px solid grey;">Index</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Original<br>
Sample</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Training<br>
Sample</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Test<br>
Sample</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Optimism</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Corrected<br>
Index</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Successful<br>
Resamples</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><em>D<sub>xy</sub></em></td>
<td style="text-align: center;">0.3228</td>
<td style="text-align: center;">0.3514</td>
<td style="text-align: center;">0.298</td>
<td style="text-align: center;">0.0533</td>
<td style="text-align: center;">0.2695</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>R<sup>2</sup></em></td>
<td style="text-align: center;">0.2125</td>
<td style="text-align: center;">0.2513</td>
<td style="text-align: center;">0.1779</td>
<td style="text-align: center;">0.0735</td>
<td style="text-align: center;">0.139</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Slope</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0.7844</td>
<td style="text-align: center;">0.2156</td>
<td style="text-align: center;">0.7844</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>D</em></td>
<td style="text-align: center;">0.0296</td>
<td style="text-align: center;">0.036</td>
<td style="text-align: center;">0.0242</td>
<td style="text-align: center;">0.0118</td>
<td style="text-align: center;">0.0178</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>U</em></td>
<td style="text-align: center;">-5e-04</td>
<td style="text-align: center;">-5e-04</td>
<td style="text-align: center;">0.0025</td>
<td style="text-align: center;">-0.003</td>
<td style="text-align: center;">0.0025</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>Q</em></td>
<td style="text-align: center;">0.0301</td>
<td style="text-align: center;">0.0365</td>
<td style="text-align: center;">0.0217</td>
<td style="text-align: center;">0.0148</td>
<td style="text-align: center;">0.0152</td>
<td style="text-align: center;">1000</td>
</tr>
<tr class="odd">
<td style="text-align: left; border-bottom: 2px solid grey;"><em>g</em></td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.7245</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.8108</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.6345</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.1763</td>
<td style="text-align: center; border-bottom: 2px solid grey;">0.5482</td>
<td style="text-align: center; border-bottom: 2px solid grey;">1000</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>shrinkage_est <span class="ot">&lt;-</span> v[<span class="dv">3</span>, <span class="dv">5</span>] <span class="co"># Extract bootstrap estimate of shrinkage</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>f_prediction <span class="ot">&lt;-</span> f</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>f_prediction<span class="sc">$</span>coefficients <span class="ot">&lt;-</span> f<span class="sc">$</span>coefficients <span class="sc">*</span> shrinkage_est</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(f_prediction, <span class="at">html =</span> <span class="cn">TRUE</span>, <span class="at">coef =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<p><strong>Cox Proportional Hazards Model</strong></p>

<pre>cph(formula = s ~ rx + rcs(age, 4) + rcs(wt, 3) + pf_linear + 
    heart_d + rcs(map, 3) + rcs(hg, 4) + rcs(sg, 3) + rcs(sz, 
    3) + rcs(log(ap), 5) + bm, x = TRUE, y = TRUE, surv = TRUE, 
    time.inc = 5 * 12)
</pre>


<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black;">Model Tests</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black;">Discrimination<br>
Indexes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">Obs 502</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">LR χ<sup>2</sup> 119.86</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup>2</sup> 0.212</td>
</tr>
<tr class="even">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">Events 354</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">d.f. 24</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup><span style="font-size: 70%;">2</span></sup><sub><span style="font-size: 70%;">24,502</span></sub> 0.174</td>
</tr>
<tr class="odd">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">Center -2.3792</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">Pr(&gt;χ<sup>2</sup>) 0.0000</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup><span style="font-size: 70%;">2</span></sup><sub><span style="font-size: 70%;">24,354</span></sub> 0.237</td>
</tr>
<tr class="even">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;"></td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">Score χ<sup>2</sup> 126.89</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>D</em><sub>xy</sub> 0.323</td>
</tr>
<tr class="odd">
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black;"></td>
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black;">Pr(&gt;χ<sup>2</sup>) 0.0000</td>
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black;"></td>
</tr>
</tbody>
</table>




<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; border-bottom: 1px solid grey; border-top: 2px solid grey;"></th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">β</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">S.E.</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Wald <em>Z</em></th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Pr(&gt;|<em>Z</em>|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; min-width: 7em;">rx=0.2 mg estrogen</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.0004</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.1492</td>
<td style="text-align: right; min-width: 7em;">0.00</td>
<td style="text-align: right; min-width: 7em;">0.9980</td>
</tr>
<tr class="even">
<td style="text-align: left; min-width: 7em;">rx=1.0 mg estrogen</td>
<td style="text-align: right; min-width: 7em;">&nbsp; -0.3244</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.1659</td>
<td style="text-align: right; min-width: 7em;">-1.96</td>
<td style="text-align: right; min-width: 7em;">0.0506</td>
</tr>
<tr class="odd">
<td style="text-align: left; min-width: 7em;">rx=5.0 mg estrogen</td>
<td style="text-align: right; min-width: 7em;">&nbsp; -0.0819</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.1572</td>
<td style="text-align: right; min-width: 7em;">-0.52</td>
<td style="text-align: right; min-width: 7em;">0.6024</td>
</tr>
<tr class="even">
<td style="text-align: left; min-width: 7em; border-bottom: 2px solid grey;">…</td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="approximating-the-full-model" class="level3">
<h3 class="anchored" data-anchor-id="approximating-the-full-model">Approximating the full model</h3>
<p>If the client doesn’t want to collect all these variables for prediction we can do model approximation. The goal is to explain <code>f_prediction</code>with a trade off between parameters and <span class="math inline">\(R^2\)</span>. This can be done by backwards selection.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">predict</span>(f_prediction) <span class="co"># compute linear predictor from full model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in formula.character(object, env = baseenv()): Using formula(x) is deprecated when x is a character vector of length &gt; 1.
  Consider formula(paste(x, collapse = " ")) instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Force sigma to be 1 since perfect fit</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">ols</span>(z <span class="sc">~</span> rx <span class="sc">+</span> <span class="fu">rcs</span>(age, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(wt, <span class="dv">3</span>) <span class="sc">+</span> pf_linear <span class="sc">+</span> heart_d <span class="sc">+</span> <span class="fu">rcs</span>(map, <span class="dv">3</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">rcs</span>(hg, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(sg, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">rcs</span>(sz, <span class="dv">3</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">+</span> <span class="fu">rcs</span>(<span class="fu">log</span>(ap), <span class="dv">5</span>) <span class="sc">+</span> bm, <span class="at">sigma =</span> <span class="dv">1</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>backwards <span class="ot">&lt;-</span> <span class="fu">fastbw</span>(a, <span class="at">aics =</span> <span class="dv">10000</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(backwards, <span class="at">html =</span> <span class="cn">TRUE</span>, <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 Deleted   Chi-Sq d.f. P      Residual d.f. P      AIC    R2   
 map        0.07  2    0.9641   0.07    2   0.9641  -3.93 1.000
 bm         0.04  1    0.8321   0.12    3   0.9896  -5.88 0.999
 sg         2.50  2    0.2861   2.62    5   0.7582  -7.38 0.987
 pf_linear  4.88  1    0.0271   7.51    6   0.2767  -4.49 0.964
 rx        15.66  3    0.0013  23.16    9   0.0058   5.16 0.888
 wt        12.41  2    0.0020  35.57   11   0.0002  13.57 0.828
 age       16.50  3    0.0009  52.08   14   0.0000  24.08 0.748
 ap        19.61  4    0.0006  71.69   18   0.0000  35.69 0.653
 hg        36.53  3    0.0000 108.22   21   0.0000  66.22 0.475
 sz        42.83  2    0.0000 151.04   23   0.0000 105.04 0.268
 heart_d   55.27  1    0.0000 206.31   24   0.0000 158.31 0.000

Approximate Estimates after Deleting Factors

         Coef   S.E.  Wald Z P
[1,] 7.58e-11 0.0446 1.7e-09 1

Factors in Final Model

None</code></pre>
</div>
</div>
<p>Now the client can choose the trade-off between predictive ability and number of predictors. We visualize this in the following plot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(backwards<span class="sc">$</span>result)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>total_predictors <span class="ot">&lt;-</span> <span class="fu">nrow</span>(result)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> result<span class="sc">$</span>R2</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>predictors <span class="ot">&lt;-</span> <span class="fu">c</span>((total_predictors <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">0</span>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(predictors, r_squared), <span class="fu">aes</span>(<span class="at">x =</span> predictors, <span class="at">y =</span> r_squared)) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Predictors"</span>, <span class="at">y =</span> <span class="fu">TeX</span>(<span class="st">"$R^2$"</span>)) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"R-squared vs. Predictors"</span>) <span class="sc">+</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty_breaks</span>()) <span class="sc">+</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="cox_files/figure-html/plot predictive ability and number of predictors-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A reasonable approach trade off would be to remove map, bm, sg and pf_linear from our model to get an approximate model which still has high <span class="math inline">\(R^2\)</span> of <span class="math inline">\(0.96\)</span> for explaining the full model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>f_approx <span class="ot">&lt;-</span> <span class="fu">ols</span>(z <span class="sc">~</span> rx <span class="sc">+</span> <span class="fu">rcs</span>(age, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(wt, <span class="dv">3</span>) <span class="sc">+</span> heart_d</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>                <span class="sc">+</span> <span class="fu">rcs</span>(hg, <span class="dv">4</span>) <span class="sc">+</span> <span class="fu">rcs</span>(sz, <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">rcs</span>(<span class="fu">log</span>(ap), <span class="dv">5</span>), <span class="at">x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(f_approx, <span class="at">html =</span> <span class="cn">TRUE</span>, <span class="at">coefs =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<p><strong>Linear Regression Model</strong></p>

<pre>ols(formula = z ~ rx + rcs(age, 4) + rcs(wt, 3) + heart_d + rcs(hg, 
    4) + rcs(sz, 3) + rcs(log(ap), 5), x = TRUE)
</pre>


<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black;"></th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black;">Model Likelihood<br>
Ratio Test</th>
<th data-quarto-table-cell-role="th" style="text-align: center; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey; border-right: 1px solid black;">Discrimination<br>
Indexes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">Obs 502</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">LR χ<sup>2</sup> 1663.53</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup>2</sup> 0.964</td>
</tr>
<tr class="even">
<td style="text-align: center; min-width: 9em; border-left: 1px solid black; border-right: 1px solid black;">σ 0.1247</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;">d.f. 18</td>
<td style="text-align: center; min-width: 9em; border-right: 1px solid black;"><em>R</em><sup><span style="font-size: 70%;">2</span></sup><sub><span style="font-size: 70%;">adj</span></sub> 0.962</td>
</tr>
<tr class="odd">
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-left: 1px solid black; border-right: 1px solid black;">d.f. 483</td>
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black;">Pr(&gt;χ<sup>2</sup>) 0.0000</td>
<td style="text-align: center; min-width: 9em; border-bottom: 2px solid grey; border-right: 1px solid black;"><em>g</em> 0.713</td>
</tr>
</tbody>
</table>



<p>Residuals</p>

<pre>     Min       1Q   Median       3Q      Max 
-0.30962 -0.07092 -0.02333  0.04420  0.63137 
</pre>



<table class="gmisc_table caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; border-bottom: 1px solid grey; border-top: 2px solid grey;"></th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">β</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">S.E.</th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;"><em>t</em></th>
<th data-quarto-table-cell-role="th" style="text-align: right; font-weight: 900; border-bottom: 1px solid grey; border-top: 2px solid grey;">Pr(&gt;|<em>t</em>|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; min-width: 7em;">Intercept</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 3.7212</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.1976</td>
<td style="text-align: right; min-width: 7em;">18.83</td>
<td style="text-align: right; min-width: 7em;">&lt;0.0001</td>
</tr>
<tr class="even">
<td style="text-align: left; min-width: 7em;">rx=0.2 mg estrogen</td>
<td style="text-align: right; min-width: 7em;">&nbsp; 0.0070</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.0158</td>
<td style="text-align: right; min-width: 7em;">0.44</td>
<td style="text-align: right; min-width: 7em;">0.6600</td>
</tr>
<tr class="odd">
<td style="text-align: left; min-width: 7em;">rx=1.0 mg estrogen</td>
<td style="text-align: right; min-width: 7em;">&nbsp; -0.4338</td>
<td style="text-align: right; min-width: 7em;">&nbsp;0.0159</td>
<td style="text-align: right; min-width: 7em;">-27.32</td>
<td style="text-align: right; min-width: 7em;">&lt;0.0001</td>
</tr>
<tr class="even">
<td style="text-align: left; min-width: 7em; border-bottom: 2px solid grey;">…</td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
<td style="text-align: right; min-width: 7em; border-bottom: 2px solid grey;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>We devolved a Cox proportional hazards model to explain time until death (of any cause) for this dataset. We described the effects the predictors in the model had by various plots.</p>
<p>We did validation and calibration if one wished to use the model for prediction, to avoid issues such as regression to the mean. We then developed a simplified model which dropped 4 predictors, but could still predict the full model with high accuracy (<span class="math inline">\(R^2=0.964)\)</span>.</p>
<p>Throughout we used the guidelines of Regression Modelling Strategies to follow sounds statistical strategies when building and validating a model.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© Copyright 2024, Bjarke Hautop Kristensen</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This page is built with <a href="https://quarto.org/">Quarto</a></p>
</div>
  </div>
</footer>




</body></html>